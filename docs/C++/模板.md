

## **模板的分文件编写**

对于一般的函数我可能会将其进行定义和声明的分离编写，即声明写道 .h 文件中，定义写到 .cpp 文件中，但是对模板来说直接这样写会有一些问题。

```cpp
// Example.h
// 函数声明
template<class T>
void func(T);
```

```cpp
// Example.cpp
// 函数定义
template<class T>
void func(T)
{
    // 实现
}
```

```cpp
// main.cpp
# include<Example.h>
int main()
{
    func(1);
    return 0;
}
```

按照一般的分离编译写法如上。

在编译时，在调用模板的地方会在 main.cpp 文件中找对应的函数地址，但是只能找到声明，没有定义，没办法进行函数实例化，就得不到对应的地址，所以只能等到链接的时候到其他文件或库中找该函数的地址。

但是到链接的过程时，却根本找不到对应的函数实现，应为对应模板根本没有实例化，所以就会报链接错误。

解决方法有两种：

- 第一种就是在 .cpp 文件中进行显示实例化

```cpp
// Example.cpp
template<class T>
void func(T)
{
    // 实现
}
// 显示实例化
template void func(int);
```

但是这种方法缺陷也很明显，会让代码编写变得非常麻烦，每次需要新的类型都要加上新的显示实例化。

- 第二种就是将模板的定义和声明写道同一个文件中(.h 或 .hpp 文件中)，就从根源上解决了该问题，这通常更简单实用。