

## **进程间通信**

进程间通信 (InterProcess Communication，IPC)，就是进程之间进行信息交换、共享资源、事件通知以及进程间的控制等行为。

因为每个进程之间是相互独立的，所以他们想要进行通信，就要借助到操作系统。操作系统提供了多种进程间通信的方式：

- 管道
- System V IPC
- POSIX IPC


## **管道**

管道是 Unix 系统最古老的一种进程间通信方式。我们在 Unix 命令行下一定用过 `|` ，来实现将上一个命令的输出交给下一命令作为输入，例如下面的命令：

<figure markdown="span">
  ![Image title](01.png){ width="550" }
</figure>

这个 `|` 就是创建了一个匿名管道。所以管道就是一个进程数据流向另一个进程的媒介。而每个进程是相互独立的所以，不可能直接在两个进程的地址空间上分别读取数据，而是由内核提供一个媒介，即管道。

### **原理**

现在思考一下，如果没有管道，我们该怎么实现将一个进程的输出交给另一个进程？

我们可以让两个进程打开同一个文件，一个以读方式，一个以写方式打开，因为同一个文件只会在内存创建一个文件对象，所以我们的写进程每次输出后，只要将数据强制刷新到文件缓存区中，这样读进程就可以在该文件缓存区中读到写进程写入的数据。但是这样进程通信的数据会留在磁盘中，还要我们手动清理，不然再次使用该文件通信时，会有旧数据干扰。

所以系统给我们提供了管道，管道的本质其实就是一个文件对象，但是其文件信息只存在于内存中，当管道文件被从内存中释放时，并不会将数据写入磁盘。

并且对于一些特殊情况，管道会比普通文件更易处理：

- 如果管道中没有数据，读端会阻塞，等待到管道中有数据为止。
- 如果管道被写满了，写端会阻塞，直到有空间后（即有数据被读端读走），才能写入。
- 写端关闭，读端读取，`read` 会返回 0。
- 读端关闭，写端一直写入，`OS` 会杀掉写端进程。

管道还有下面的特性，便于使用：

- 字节流通信，管道中数据的读写单位是字节。
- 单向通信，要么一边读，要么一边写，不可以边读边写。
- 同步机制，读端只能按照写端写入的顺序读取数据。
- 管道声明周期随进程，进程结束，管道也会结束。



### **匿名管道**

匿名管道使用库函数 `pipe()`，可以创建一个匿名管道。

```cpp
# include<unistd.h>
int pipe(int fildes[2]);
```

该函数会创建一个文件对象作为管道，并且将读端 fd 存在 `fildes[0]` 中，写端 fd 存在 `fildes[1]` 中。

匿名管道是只存在于内存中的，完全不占据磁盘空间。并且只能让有亲缘关系的进程间进行通信。





### **命名管道**

